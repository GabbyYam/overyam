<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="github.com/GabbyYam/overyam/favicon.png" />
    

    <title>
        
          Design &amp; Design pattern/Effective-Java/Note/EJ-01 - Overyam
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="github.com/GabbyYam/overyam/css/book.css">

    
<script src="github.com/GabbyYam/overyam/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="github.com/GabbyYam/overyam/">
    <img src="github.com/GabbyYam/overyam/favicon.png">
    <span>OVERYAM</span>
  </a>
</div>
    <div class="book-menu">
  
</div>


<script src="github.com/GabbyYam/overyam/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <p>[TOC]</p>
<h1 id="Create-amp-Destroying-Objects"><a href="#Create-amp-Destroying-Objects" class="headerlink" title="Create&amp;Destroying Objects"></a>Create&amp;Destroying Objects</h1><h2 id="静态工厂StaticFactory"><a href="#静态工厂StaticFactory" class="headerlink" title="静态工厂StaticFactory"></a>静态工厂StaticFactory</h2><ul>
<li>注意这里说的静态工厂不是设计模式里的工厂方法<img src="diagram/image-20191218150425221.png" alt="image-20191218150425221"></li>
<li>优点：主要归为以下几点<ul>
<li>名字好看，而不是和构造器一样是个类名加括号</li>
<li>不需要每次都返回一个新的实例，而是有已经创建好的缓存实例（类似单例的思想？）</li>
<li><strong>可以返回任何返回类型的子类型，使得程序灵活性更好</strong></li>
<li>基于上者，静态工厂在互相调用的过程中，返回类型可以不断改变</li>
<li>编写改静态工厂时，返回的对象所属的类可以不必存在（也就是可以先写静态工厂再写类）</li>
</ul>
</li>
<li>缺点：主要依赖于构造器Constructor<ul>
<li>如果该类没有public或protected构造器的话，就无法返回子类了</li>
<li>一般不会写在API文档里，所以会比较难找</li>
</ul>
</li>
</ul>
<h2 id="建造者Builder"><a href="#建造者Builder" class="headerlink" title="建造者Builder"></a>建造者Builder</h2><p>当构造器参数非常多的时候，考虑使用Builder</p>
<ul>
<li>Java Bean的弊端：<ul>
<li>Bean在构造过程中可能会产生数据不一致</li>
<li>Bean不能将类做成immutable，这样就必须得考虑线程安全的问题了</li>
</ul>
</li>
<li>Builder的优点<ul>
<li>可读性强，写起来也很方便</li>
<li>非常适合类继承：抽象类有抽象类的Builder，实现类有实现类的Builder，实现类的Builder可以直接继承父类的Builder，再重写build方法即可，<strong>灵活易于扩展</strong></li>
</ul>
</li>
</ul>
<h2 id="单例设计"><a href="#单例设计" class="headerlink" title="单例设计"></a>单例设计</h2><p>用<strong>private Constructor</strong>或<strong>Enum type</strong>来实现单例属性</p>
<ul>
<li><p>优点：</p>
<ul>
<li>每次返回相同的对象引用</li>
<li>更加简洁</li>
<li>在不改变API接口的情况下，更灵活的在单例和非单例之间切换（静态工厂static factory）</li>
<li>为了保证反序列化后仍然返回相同的instance，添加readResolve method或Enum type的</li>
</ul>
<p>注意当该类要 extends 别的类时，不能使用Enum</p>
</li>
</ul>
<h2 id="适当使用依赖注入-dependency-injection"><a href="#适当使用依赖注入-dependency-injection" class="headerlink" title="适当使用依赖注入 dependency injection"></a>适当使用依赖注入 dependency injection</h2><p>如果某类可能依赖多项基础资源underlying resource，不要采用单例或是static的方式去依赖资源，而是采用依赖注入的方式，这样可能通过更改配置文件的方式，更灵活且testable得来对外部资源进行依赖</p>
<h2 id="不要创建没用-amp-多余的objects"><a href="#不要创建没用-amp-多余的objects" class="headerlink" title="不要创建没用&amp;多余的objects"></a>不要创建没用&amp;多余的objects</h2><ul>
<li>能引用常量时不要采用new的方式</li>
<li>能用基本类型时不要使用包装类</li>
<li>string.match隐含了每次执行都要new一个pattern，因此要注意避免此类情况产生</li>
<li>当然有时根据需要可能要new新的object而不是复用已有的object</li>
</ul>
<h2 id="删除不需要的reference"><a href="#删除不需要的reference" class="headerlink" title="删除不需要的reference"></a>删除不需要的reference</h2><p>目的是防止内存泄漏，让内存被gc回收</p>
<p>内存泄漏的常见来源：</p>
<ul>
<li>缓存cache：比如HashMap缓存时，其实可以用WeakHashMap来替代会更好，这样可以被自动gc</li>
<li>监听和回调(listener and callbacks)：简单的解决办法是全部采用弱引用（weak reference）的方式</li>
</ul>
<h2 id="尽量不使用finalizer-amp-cleaner"><a href="#尽量不使用finalizer-amp-cleaner" class="headerlink" title="尽量不使用finalizer &amp; cleaner"></a>尽量不使用finalizer &amp; cleaner</h2><p>cleaner是Java9引入的finalizer的替代品，两者相当于C++中的destructor（析构函数）</p>
<p><strong>不使用的原因&amp;缺点</strong>：</p>
<ul>
<li><p>因为他们都具有不可预测性，因此如果在不恰当的时间回收了资源，就会发生错误</p>
</li>
<li><p>如果finalizer的优先级很低，可能资源在很长一段时间都不会被回收，最后outOfMemoryError</p>
</li>
</ul>
<p><strong>==相关分析比较复杂，待补充==</strong></p>
<h2 id="永远要用try-with-resource而不是try-finally来链接资源"><a href="#永远要用try-with-resource而不是try-finally来链接资源" class="headerlink" title="永远要用try-with-resource而不是try-finally来链接资源"></a>永远要用try-with-resource而不是try-finally来链接资源</h2><p>所谓try-with-resource即将资源的连接写在try(…)括号内，而不是写在finally域内</p>
<ul>
<li>一来如果要开启多个resource，那么写在finally内很丑很长很麻烦</li>
<li>写在try括号内，可读性更强</li>
<li>前者的写法同样可以达到相同的效果</li>
</ul>

</div>


  <div class="book-comments">
    




  </div>



<script src="github.com/GabbyYam/overyam/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure
          class="avatar avatar-lg"
          data-initial="G"
          style="background-color: #3b4351;">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>GabbyYam</div>
      <div>2020-02-25</div>
    </div>
  </div>

  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="github.com/GabbyYam/overyam/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="github.com/GabbyYam/overyam/js/book.js"></script>
