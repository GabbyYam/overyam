<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    OverYam
  
</title>

<meta name="description" content="On Your Mark">
<meta property="og:type" content="website">
<meta property="og:title" content="OverYam">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="OverYam">
<meta property="og:description" content="On Your Mark">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="GabbyYam">
<meta name="twitter:card" content="summary">


  <link rel="alternative" href="/atom.xml" title="OverYam" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">



<link rel="stylesheet" href="https://github.com/GabbyYam/overyam/perfect-scrollbar/css/perfect-scrollbar.min.css">


<link rel="stylesheet" href="https://github.com/GabbyYam/overyam/styles/main.css">







<meta name="generator" content="Hexo 4.2.0"></head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="https://github.com/GabbyYam/overyam/" target="_blank" rel="noopener">OverYam</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="https://github.com/GabbyYam/overyam/" target="_blank" rel="noopener">OverYam</a></h1>
    
    <div class="info">
      <div class="content">
        
          <div class="description">On Your Mark</div>
        
        
          <div class="author">GabbyYam</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="https://cn.gravatar.com/avatar/35fef74d731255cd569c2c2b0b9e87e4?s=200"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="https://github.com/GabbyYam/overyam/archives/2020/" target="_blank" rel="noopener">2020</a><span class="archive-list-count">44</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/GabbyYam/overyam/" target="_blank" rel="noopener" title="Homepage" external="false">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/GabbyYam/overyam/archives" target="_blank" rel="noopener" title="By Year" external="false">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/denjones/hexo-theme-chan" title="Chan" target="_blank" rel="noopener">Chan</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/denjones" title="Github" target="_blank" rel="noopener">Github</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/GabbyYam/overyam/atom.xml" target="_blank" rel="noopener" title="RSS" external="false">RSS</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Design%20&%20Design%20pattern/Effective-Java/Note/EJ-02/" target="_blank" rel="noopener" >
  Design &amp; Design pattern/Effective-Java/Note/EJ-02
</a>

      </h3>
      

      <div class="article-info">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Design%20&%20Design%20pattern/Effective-Java/Note/EJ-02/" target="_blank" rel="noopener"><span class="article-date">
  2020-02-25
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          <p>[TOC]</p>
<h1 id="对象的通用方法（讨论如何覆写非final方法）"><a href="#对象的通用方法（讨论如何覆写非final方法）" class="headerlink" title="对象的通用方法（讨论如何覆写非final方法）"></a>对象的通用方法（讨论如何覆写非final方法）</h1><h2 id="重写-equals"><a href="#重写-equals" class="headerlink" title="重写 equals"></a>重写 equals</h2><p><strong>不需要重写equals的情况：</strong></p>
<ul>
<li>对于每一个对象实例应该是unique的时</li>
<li>根据API设计的需要，没必要提供逻辑上的相等时</li>
<li>父类已经重写equals方法且子类直接继承就合适时</li>
<li>外部没有权限访问该类的内部方法时</li>
</ul>
<p><strong>重写需要满足一下性质</strong></p>
<ul>
<li>自反性：self equals self时必须返回true</li>
<li>对称性：如果A equals B返回true 那么反之也要返回true</li>
<li>传递性：A equals B 且B equals C，那么A也必须equals C</li>
<li>不变性：每次调用应该返回相同的结果</li>
<li>非空性：对于所有非空的对象equals null 必须返回false</li>
</ul>
<p><strong>==如果不满足以上性质会怎么样？有空的时候思考一下，待补全。==</strong></p>
<p><strong>高质量的equals实现代码的一些tips：</strong></p>
<ul>
<li><p>用 == 来判定参数是否是一个对象的引用，如果是则返回true（自反性），此为一种效率上的优化，因为做全面的对比代价可能较大</p>
</li>
<li><p>用 instanceof 去判断参数的类型，如果类型不对那么直接返回false</p>
</li>
<li><p>如果通过的instanceof的测试，将参数强转为对应类的对象以保证下面的检测正确的进行</p>
</li>
<li><p>对于所有有意义的字段field进行比对，如果matches则通过返回true，否则返回false</p>
<ul>
<li><p>其中对于<strong>非float/double类型的基本数据类型</strong>，直接用==判断，对象则递归地用equals判断</p>
<p>而float和double则用以下方法来判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Float.compare();</span><br><span class="line">Double.compare();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>某些部分可能存在非法的null，用Objects.equals（）来检查避免报空指针异常</p>
</li>
<li><p>优先比对最可能不同的部分，至于一些派生而来的字段不需要比对（因为没有意义，比如c=a+b;如果a，b相同则c必定相同）</p>
</li>
<li><p><strong>写完equals方法后，检查是否满足重写的五大性质</strong></p>
</li>
<li><p>当然最好的方法其实是用IDE或AutoValue自动生成（？</p>
</li>
</ul>
<h2 id="如果重写了equals那么就必须重写hashCode"><a href="#如果重写了equals那么就必须重写hashCode" class="headerlink" title="如果重写了equals那么就必须重写hashCode"></a>如果重写了equals那么就必须重写hashCode</h2><p><strong>重写得到hashCode方法产生的hash值必须满足以下性质：</strong></p>
<ul>
<li>在同一程序内反复调用应该返回相同的hash值，而在不同的程序中则不需要</li>
<li>如果两个object是equals（Object）的，那么hashCode也应该相同</li>
<li>如果不equals（Object），不要求一定不同，但是要尽量让hash散列表更加均匀</li>
</ul>
<p><strong>以下是一个简单易用的hashCode生成策略：</strong></p>
<ul>
<li><p>对于每个有意义的字段都要分别递归地取得他们的hash值</p>
</li>
<li><p>对于基本数据类型，用包装类的hashCode方法</p>
</li>
<li><p>对于引用类型，同样递归的调取hashCode</p>
</li>
<li><p>对于组合派生而来的字段直接跳过即可</p>
</li>
<li><p>空值默认为hash值为0</p>
</li>
<li><p>如果某字段是个数组，分几种情况</p>
<ul>
<li>有意义字段：同上述</li>
<li>无意义字段：非0常数</li>
<li>如果所有都有意义，可以采用Arrays.hashCode</li>
</ul>
</li>
<li><p>对每一步得到的hash值，作以下计算</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//31*x可以被JVM优化，计算效率比较高</span></span><br><span class="line">result=result*<span class="number">31</span>+c;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="记得一定要重写toString方法"><a href="#记得一定要重写toString方法" class="headerlink" title="记得一定要重写toString方法"></a>记得一定要重写toString方法</h2><p>debug、调试用，好处多多</p>
<h2 id="重写clone方法"><a href="#重写clone方法" class="headerlink" title="重写clone方法"></a>重写clone方法</h2><p><strong>重写的clone方法必须满足以下基本要求：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x.clone()!=x;</span><br><span class="line">x.clone().getClass()==x.getClass();</span><br><span class="line">x.clone().euqals(x)==<span class="keyword">true</span>;<span class="comment">//这条并不强制要求</span></span><br></pre></td></tr></table></figure>

<p>….明日再战….太痛苦了…==待补全==</p>
<h2 id="实现Comparable-接口"><a href="#实现Comparable-接口" class="headerlink" title="实现Comparable 接口"></a>实现Comparable 接口</h2><ul>
<li><p>并非定义在Object内</p>
</li>
<li><p>实现该接口能带来种种便利，比如自然排序</p>
</li>
<li><p>基本原则，类似于equals</p>
<ul>
<li>自反性、传递性、不自相矛盾、compare==0时必须equals</li>
</ul>
</li>
<li><p>快速构建compareTo方法：comparator<img src="diagram/image-20200118092704727.png" alt="image-20200118092704727"></p>
</li>
<li><p>基本数据类型用包装类的compare方法来比较</p>
</li>
</ul>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Design%20&%20Design%20pattern/Effective-Java/Note/EJ-01/" target="_blank" rel="noopener" >
  Design &amp; Design pattern/Effective-Java/Note/EJ-01
</a>

      </h3>
      

      <div class="article-info">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Design%20&%20Design%20pattern/Effective-Java/Note/EJ-01/" target="_blank" rel="noopener"><span class="article-date">
  2020-02-25
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          <p>[TOC]</p>
<h1 id="Create-amp-Destroying-Objects"><a href="#Create-amp-Destroying-Objects" class="headerlink" title="Create&amp;Destroying Objects"></a>Create&amp;Destroying Objects</h1><h2 id="静态工厂StaticFactory"><a href="#静态工厂StaticFactory" class="headerlink" title="静态工厂StaticFactory"></a>静态工厂StaticFactory</h2><ul>
<li>注意这里说的静态工厂不是设计模式里的工厂方法<img src="diagram/image-20191218150425221.png" alt="image-20191218150425221"></li>
<li>优点：主要归为以下几点<ul>
<li>名字好看，而不是和构造器一样是个类名加括号</li>
<li>不需要每次都返回一个新的实例，而是有已经创建好的缓存实例（类似单例的思想？）</li>
<li><strong>可以返回任何返回类型的子类型，使得程序灵活性更好</strong></li>
<li>基于上者，静态工厂在互相调用的过程中，返回类型可以不断改变</li>
<li>编写改静态工厂时，返回的对象所属的类可以不必存在（也就是可以先写静态工厂再写类）</li>
</ul>
</li>
<li>缺点：主要依赖于构造器Constructor<ul>
<li>如果该类没有public或protected构造器的话，就无法返回子类了</li>
<li>一般不会写在API文档里，所以会比较难找</li>
</ul>
</li>
</ul>
<h2 id="建造者Builder"><a href="#建造者Builder" class="headerlink" title="建造者Builder"></a>建造者Builder</h2><p>当构造器参数非常多的时候，考虑使用Builder</p>
<ul>
<li>Java Bean的弊端：<ul>
<li>Bean在构造过程中可能会产生数据不一致</li>
<li>Bean不能将类做成immutable，这样就必须得考虑线程安全的问题了</li>
</ul>
</li>
<li>Builder的优点<ul>
<li>可读性强，写起来也很方便</li>
<li>非常适合类继承：抽象类有抽象类的Builder，实现类有实现类的Builder，实现类的Builder可以直接继承父类的Builder，再重写build方法即可，<strong>灵活易于扩展</strong></li>
</ul>
</li>
</ul>
<h2 id="单例设计"><a href="#单例设计" class="headerlink" title="单例设计"></a>单例设计</h2><p>用<strong>private Constructor</strong>或<strong>Enum type</strong>来实现单例属性</p>
<ul>
<li><p>优点：</p>
<ul>
<li>每次返回相同的对象引用</li>
<li>更加简洁</li>
<li>在不改变API接口的情况下，更灵活的在单例和非单例之间切换（静态工厂static factory）</li>
<li>为了保证反序列化后仍然返回相同的instance，添加readResolve method或Enum type的</li>
</ul>
<p>注意当该类要 extends 别的类时，不能使用Enum</p>
</li>
</ul>
<h2 id="适当使用依赖注入-dependency-injection"><a href="#适当使用依赖注入-dependency-injection" class="headerlink" title="适当使用依赖注入 dependency injection"></a>适当使用依赖注入 dependency injection</h2><p>如果某类可能依赖多项基础资源underlying resource，不要采用单例或是static的方式去依赖资源，而是采用依赖注入的方式，这样可能通过更改配置文件的方式，更灵活且testable得来对外部资源进行依赖</p>
<h2 id="不要创建没用-amp-多余的objects"><a href="#不要创建没用-amp-多余的objects" class="headerlink" title="不要创建没用&amp;多余的objects"></a>不要创建没用&amp;多余的objects</h2><ul>
<li>能引用常量时不要采用new的方式</li>
<li>能用基本类型时不要使用包装类</li>
<li>string.match隐含了每次执行都要new一个pattern，因此要注意避免此类情况产生</li>
<li>当然有时根据需要可能要new新的object而不是复用已有的object</li>
</ul>
<h2 id="删除不需要的reference"><a href="#删除不需要的reference" class="headerlink" title="删除不需要的reference"></a>删除不需要的reference</h2><p>目的是防止内存泄漏，让内存被gc回收</p>
<p>内存泄漏的常见来源：</p>
<ul>
<li>缓存cache：比如HashMap缓存时，其实可以用WeakHashMap来替代会更好，这样可以被自动gc</li>
<li>监听和回调(listener and callbacks)：简单的解决办法是全部采用弱引用（weak reference）的方式</li>
</ul>
<h2 id="尽量不使用finalizer-amp-cleaner"><a href="#尽量不使用finalizer-amp-cleaner" class="headerlink" title="尽量不使用finalizer &amp; cleaner"></a>尽量不使用finalizer &amp; cleaner</h2><p>cleaner是Java9引入的finalizer的替代品，两者相当于C++中的destructor（析构函数）</p>
<p><strong>不使用的原因&amp;缺点</strong>：</p>
<ul>
<li><p>因为他们都具有不可预测性，因此如果在不恰当的时间回收了资源，就会发生错误</p>
</li>
<li><p>如果finalizer的优先级很低，可能资源在很长一段时间都不会被回收，最后outOfMemoryError</p>
</li>
</ul>
<p><strong>==相关分析比较复杂，待补充==</strong></p>
<h2 id="永远要用try-with-resource而不是try-finally来链接资源"><a href="#永远要用try-with-resource而不是try-finally来链接资源" class="headerlink" title="永远要用try-with-resource而不是try-finally来链接资源"></a>永远要用try-with-resource而不是try-finally来链接资源</h2><p>所谓try-with-resource即将资源的连接写在try(…)括号内，而不是写在finally域内</p>
<ul>
<li>一来如果要开启多个resource，那么写在finally内很丑很长很麻烦</li>
<li>写在try括号内，可读性更强</li>
<li>前者的写法同样可以达到相同的效果</li>
</ul>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Database/mysql%E7%BB%8F%E5%85%B850%E9%A2%98/" target="_blank" rel="noopener" >
  Database/mysql经典50题
</a>

      </h3>
      

      <div class="article-info">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Database/mysql%E7%BB%8F%E5%85%B850%E9%A2%98/" target="_blank" rel="noopener"><span class="article-date">
  2020-02-25
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          
        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Design%20&%20Design%20pattern/%E4%B8%80%E4%BA%9B%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" target="_blank" rel="noopener" >
  Design &amp; Design pattern/一些设计原则
</a>

      </h3>
      

      <div class="article-info">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Design%20&%20Design%20pattern/%E4%B8%80%E4%BA%9B%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" target="_blank" rel="noopener"><span class="article-date">
  2020-02-25
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          <h1 id="面向接口编程"><a href="#面向接口编程" class="headerlink" title="面向接口编程"></a>面向接口编程</h1><p>如何保证复用代码的同时，让代码有效的分配到你希望的实现类中呢？</p>
<p>答案是面向接口编程，如果你想要分离鸭子和它的飞行、呱呱叫等行为，一个好办法是提供飞行和呱呱叫的接口，然后在其他类中再实现这些接口，这样既保证了代码能够复用，又让不会飞和呱呱叫的鸭子没有继承到与他无关的相关方法</p>
<p>面向接口编程的核心就在于抽离一个类中在子类可能会变化的部分，并将他们设计成接口，这样一来能够起到解耦的作用</p>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Concurrent%20programming/synchronized/" target="_blank" rel="noopener" >
  Concurrent programming/synchronized
</a>

      </h3>
      

      <div class="article-info">
        <a href="https://github.com/GabbyYam/overyam/2020/02/25/Concurrent%20programming/synchronized/" target="_blank" rel="noopener"><span class="article-date">
  2020-02-25
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          <p>[TOC]</p>
<h1 id="synchronized两个基本用法"><a href="#synchronized两个基本用法" class="headerlink" title="synchronized两个基本用法"></a>synchronized两个基本用法</h1><ul>
<li><p>同步方法：对于同步方法，JVM采用的是 ACC_SYNCHRONIZED 标记符来实现同步</p>
<blockquote>
<p>Method-level synchronization is performed implicitly, as part of method invocation and return (<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.11.8" target="_blank" rel="noopener">§2.11.8</a>). A <code>synchronized</code> method is distinguished in the run-time constant pool’s <code>method_info</code> structure (<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.6" target="_blank" rel="noopener">§4.6</a>) by the <code>ACC_SYNCHRONIZED</code> flag, which is checked by the method invocation instructions. When invoking a method for which <code>ACC_SYNCHRONIZED</code> is set, the executing thread enters a monitor, invokes the method itself, and exits the monitor whether the method invocation completes normally or abruptly. During the time the executing thread owns the monitor, no other thread may enter it. If an exception is thrown during invocation of the <code>synchronized</code> method and the <code>synchronized</code> method does not handle the exception, the monitor for the method is automatically exited before the exception is rethrown out of the <code>synchronized</code> method.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSth</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Hello World"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">descriptor:</span> <span class="string">()V</span></span><br><span class="line"><span class="attr">flags:</span> <span class="string">ACC_PUBLIC,</span> <span class="string">ACC_SYNCHRONIZED</span></span><br><span class="line"><span class="attr">Code:</span></span><br><span class="line"><span class="string">stack=2,</span> <span class="string">locals=1,</span> <span class="string">args_size=1</span></span><br><span class="line"><span class="attr">0:</span> <span class="string">getstatic</span>     <span class="comment">#2    // Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line"><span class="attr">3:</span> <span class="string">ldc</span>           <span class="comment">#3    // String Hello World</span></span><br><span class="line"><span class="attr">5:</span> <span class="string">invokevirtual</span> <span class="comment">#4    // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line"><span class="attr">8:</span> <span class="string">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方法级别下的同步是隐式进行的，同步方法的常量池中会有一个ACC_SYNCHRONIZED标志。当某个线程要访问某个方法的时候，会检查是否有ACC_SYNCHRONIZED，如果有设置，则需要先获得监视器锁，然后开始执行方法，方法执行之后再释放监视器锁。这时如果其他线程来请求执行方法，会因为无法获得监视器锁而被阻断住。值得注意的是，如果在方法执行过程中，发生了异常，并且方法内部并没有处理该异常，那么在异常被抛到方法外面之前监视器锁会被自动释放。</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>同步代码块：对于代码块，JVM采用 monitorenter和monitorexit来实现</p>
<blockquote>
<p>Synchronization in the Java Virtual Machine is implemented by monitor entry and exit, either explicitly (by use of the <em>monitorenter</em> and <em>monitorexit</em> instructions) or implicitly (by the method invocation and return instructions).</p>
<p>The <em>monitorenter</em> and <em>monitorexit</em> instructions enable the compilation of <code>synchronized</code> statements. </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSth1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (SynchronizedTest<span class="class">.<span class="keyword">class</span>)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello World"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">descriptor:</span> <span class="string">()V</span></span><br><span class="line"><span class="attr">flags:</span> <span class="string">ACC_PUBLIC</span></span><br><span class="line"><span class="attr">Code:</span></span><br><span class="line"><span class="string">stack=2,</span> <span class="string">locals=3,</span> <span class="string">args_size=1</span></span><br><span class="line"><span class="attr">0:</span> <span class="string">ldc</span>           <span class="comment">#5   // class com/hollis/SynchronizedTest</span></span><br><span class="line"><span class="attr">2:</span> <span class="string">dup</span></span><br><span class="line"><span class="attr">3:</span> <span class="string">astore_1</span></span><br><span class="line"><span class="attr">4:</span> <span class="string">monitorenter</span></span><br><span class="line"><span class="attr">5:</span> <span class="string">getstatic</span>     <span class="comment">#2    // Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line"><span class="attr">8:</span> <span class="string">ldc</span>           <span class="comment">#3    // String Hello World</span></span><br><span class="line"><span class="attr">10:</span> <span class="string">invokevirtual</span> <span class="comment">#4   //Methodjava/io/PrintStream.println(Ljava/lang/String;)V</span></span><br><span class="line"><span class="attr">13:</span> <span class="string">aload_1</span></span><br><span class="line"><span class="attr">14:</span> <span class="string">monitorexit</span></span><br><span class="line"><span class="attr">15:</span> <span class="string">goto</span>          <span class="number">23</span></span><br><span class="line"><span class="attr">18:</span> <span class="string">astore_2</span></span><br><span class="line"><span class="attr">19:</span> <span class="string">aload_1</span></span><br><span class="line"><span class="attr">20:</span> <span class="string">monitorexit</span></span><br><span class="line"><span class="attr">21:</span> <span class="string">aload_2</span></span><br><span class="line"><span class="attr">22:</span> <span class="string">athrow</span></span><br><span class="line"><span class="attr">23:</span> <span class="string">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#大致内容如下： 可以把执行monitorenter指令理解为加锁，执行monitorexit理解为释放锁。 每个对象维护着一个记录着被锁次数的计数器。未被锁定的对象的该计数器为0，当一个线程获得锁（执行monitorenter）后，该计数器自增变为 1 ，当同一个线程再次获得该对象的锁的时候，计数器再次自增。当同一个线程释放锁（执行monitorexit指令）的时候，计数器再自减。当计数器为0的时候。锁将被释放，其他线程便可以获得锁。</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="synchronized的锁机制"><a href="#synchronized的锁机制" class="headerlink" title="synchronized的锁机制"></a>synchronized的锁机制</h1><p>synchronized在jdk1.6以前只有传统的锁机制，属于==<strong>重量级锁</strong>==，显然性能是不怎么好的</p>
<p>然而在==jdk1.6引入两种新的锁机制：轻量级锁和偏向锁==，两者的引入是为了解决没有或几乎没有线程竞争时重量级锁资源消耗问题</p>
<p>考虑锁机制的实现之前，先谈谈对象头</p>
<h2 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h2><ul>
<li><p>JVM中，对象在内存中除了自身的信息外还存有一个对象头，保存了一些hashcode、GC相关以及锁相关的数据</p>
</li>
<li><p>对象头中存有两类信息：一是mark word，二是类型指针</p>
<ul>
<li><p>类型指针指向该类所属的类对象</p>
</li>
<li><p>markword用于存储hashcode、GC相关代信息以及锁相关的信息，markword的长度取决于操作系统的位数,以下是一个32位系统下markword各状态的格式<img src="diagram/16759dd1b0b96268" alt=""></p>
<p>可以看到，处于不同锁态的对象，markword的内容也不一样</p>
</li>
</ul>
</li>
</ul>

        
      </div>
    </div>

  
    </div>
  



  <div class="pagination">
    <a class="extend prev" rel="prev noopener" href="https://github.com/GabbyYam/overyam/page/5/" target="_blank">Prev</a><a class="page-number" href="https://github.com/GabbyYam/overyam/" target="_blank" rel="noopener">1</a><span class="space">&hellip;</span><a class="page-number" href="https://github.com/GabbyYam/overyam/page/4/" target="_blank" rel="noopener">4</a><a class="page-number" href="https://github.com/GabbyYam/overyam/page/5/" target="_blank" rel="noopener">5</a><span class="page-number current">6</span><a class="page-number" href="https://github.com/GabbyYam/overyam/page/7/" target="_blank" rel="noopener">7</a><a class="page-number" href="https://github.com/GabbyYam/overyam/page/8/" target="_blank" rel="noopener">8</a><a class="page-number" href="https://github.com/GabbyYam/overyam/page/9/" target="_blank" rel="noopener">9</a><a class="extend next" rel="next noopener" href="https://github.com/GabbyYam/overyam/page/7/" target="_blank">Next</a>
  </div>




          <div class="main-footer">
  
    © 2020 OverYam - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  
<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  
<link rel="stylesheet" href="https://github.com/GabbyYam/overyam/PhotoSwipe/photoswipe.css">

  
<link rel="stylesheet" href="https://github.com/GabbyYam/overyam/PhotoSwipe/default-skin/default-skin.css">


  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  
<script src="https://github.com/GabbyYam/overyam/PhotoSwipe/photoswipe.js"></script>

  
<script src="https://github.com/GabbyYam/overyam/PhotoSwipe/photoswipe-ui-default.js"></script>




<script src="https://github.com/GabbyYam/overyam/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>


<script src="https://github.com/GabbyYam/overyam/scripts/main.js"></script>


</body>
</html>
